<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <link rel="preconnect" href="https://fonts.googleapis.com"> 
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Roboto', sans-serif;
        }
        .menu { grid-area: menu; }
        .main { grid-area: main; }
        .description-container { grid-area: description-container; }

        .container {
          background-color: rgba(255, 255, 255, 0.8);
          text-align: center;
          padding: 20px 0;
          font-size: 30px;
        }

        .grid-container {
          display: grid;
          grid-template-areas:
            'menu main main main main description-container';
          grid-gap: 10px;
          padding: 10px;
        }

        .grid-container > div {
          background-color: rgba(255, 255, 255, 0.8);
          text-align: center;
          padding: 20px 0;
          font-size: 30px;
        }

        .button {
            margin-top: 5px;
            margin-bottom: 5px;
            margin-left: 20px;
            margin-right: 20px;
        }
    </style>
    
    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>

</head>

<body>
    <div class="container">
        <div>
            <h1>Gender Development Index Year 2019</h1>
        </div>
        <div class="grid-container">

            <div class="menu">
                <button id="btn_gdi_value" class="button" onclick="clickGdiValue()">Gender Development Index</button><br/>
                <button id="btn_hdi_female" class="button" onclick="clickHdiFemale()">Human Development Index Female</button><br/>
                <button id="btn_hdi_male" class="button" onclick="clickHdiMale()">Human Development Index Male</button><br/>
    
                <button id="btn_sdg3_female" class="button" onclick="clickSdg3Female()">Life Expectancy at Birth Female</button><br/>
                <button id="btn_sdg3_male" class="button" onclick="clickSdg3Male()">Life Expectancy at Birth Male</button><br/>
    
                <button id="btn_sdg43_female" class="button" onclick="clickSdg43Female()">Expected Years of Schooling Female</button><br/>
                <button id="btn_sdg43_male" class="button" onclick="clickSdg43Male()">Expected Years of Schooling Male</button><br/>
    
                <button id="btn_sdg44_female" class="button" onclick="clickSdg44Female()">Mean Years of Schooling Female</button><br/>
                <button id="btn_sdg44_male" class="button" onclick="clickSdg44Male()">Mean Years of Schooling Male</button><br/>
    
                <button id="btn_sdg85_female" class="button" onclick="clickSdg85Female()">Estimated Gross National Income per Capita Female</button><br/>
                <button id="btn_sdg85_male" class="button" onclick="clickSdg85Male()">Estimated Gross National Income per Capita Male</button><br/>
            </div>

            <div class="main">
                <div id="one">
                    <svg id="gdi" width="1000" height="600"></svg>
                </div>
                <div id="vs">
                    <svg id="vs-female" width="1000" height="400"></svg>
                    <svg id="vs-male" width="1000" height="400"></svg>
                </div>
            </div>

            <div class="description-container">
                <div id="gdi-description" class="description">
                    <p>Most countries give less chance for female</p>
                    <p>8 from 91 countries give chance for female better than male</p>
                    <img width="180" height="auto" src="female-vs-male-gdi.png" alt="Female vs Male GDI">
                </div>
                <div id="hdi-description" class="description">
                    <p>Most countries give less chance for female</p>
                    <p>8 from 91 countries give chance for female better than male</p>
                    <img width="180" height="auto" src="female-vs-male-gdi.png" alt="Female vs Male GDI">
                </div>
                <div id="sdg3-description" class="description">
                    <p>Almost all countries has better life expectancy for female</p>
                    <p>97 from 100 countries has better life expectancy for female</p>
                </div>
                <div id="sdg43-description" class="description">
                    <p>Most countries has better expected year of schooling for female</p>
                    <p>61 from 96 countries has better expected year of schooling for female</p>
                </div>
                <div id="sdg44-description" class="description">
                    <p>Most countries give less mean year of schooling for female</p>
                    <p>Only 27 from 93 countries give better mean year of schooling for female</p>
                </div>
                <div id="sdg85-description" class="description">
                    <p>Most countries has less estimated gross national income per capita for female</p>
                    <p>Only 3 from 95 countries has better estimated gross national income per capita for female than male</p>
                </div>
            </div>
        </div>
    </div>

    <script>

        var dataSource = d3.map();
        var topology = null

        // Load external data and boot
        d3.queue()
            .defer(d3.json, "https://raw.githubusercontent.com/adyanf/gdi_data_visualization/master/world.geojson")
            .defer(d3.csv, "https://raw.githubusercontent.com/adyanf/gdi_data_visualization/master/gdi_index.csv", function(d) { 
                dataSource.set(d.countryid, {
                    "gdivalue": d.gdivalue,
                    "hdifemale": d.hdifemale,
                    "hdimale": d.hdimale,
                    "hdirank": d.hdirank,
                    "country": d.country,
                    "countryid": d.countryid,
                    "region": d.region,
                    "humandevelopmentdegree": d.humandevelopmentdegree,
                    "gdivalue": d.gdivalue,
                    "gdigroup": d.gdigroup,
                    "hdifemale": d.hdifemale,
                    "hdimale": d.hdimale,
                    "sdg3female": d.sdg3female,
                    "sdg3male": d.sdg3male,
                    "sdg43female": d.sdg43female,
                    "sdg43male": d.sdg43male,
                    "sdg44female": d.sdg44female,
                    "sdg44male": d.sdg44male,
                    "sdg85female": d.sdg85female,
                    "sdg85male": d.sdg85male
                });
            })
            .await(ready);

        function ready(error, topo) {
            topology = topo
            clickGdiValue()
        }

        function renderMap(type) {
            // The map path
            var path = d3.geoPath();
            
            // The gender development index
            var svgGdi = d3.select("#gdi"),
            widthGdi = +svgGdi.attr("width"),
            heightGdi = +svgGdi.attr("height");

            var projectionGdi = d3.geoMercator()
            .scale(100)
            .center([0,20])
            .translate([widthGdi / 2, heightGdi / 2]);

            let zoom = d3.zoom()
            .scaleExtent([1, 8])
            .on('zoom', zoomed);

            // hover function
            let tooltip = d3.select("body")
                .append("div")
                .style("position", "absolute")
                .style("z-index", "10")
                .style("visibility", "hidden")
                .style("background", "#fff")
                .style("padding", "10px")
                .text("a simple tooltip");

            let mouseOver = function(d) {
                console.log(d);
                let data = dataSource.get(d.id)
                let text = (data != null) ? d.total : "Data not available";
                tooltip.text(d.properties.name + ": " + text)
                tooltip.style("visibility", "visible")
            }

            let mouseMove = function() {
                tooltip.style("top", (d3.event.pageY-10)+"px").style("left",(d3.event.pageX+10)+"px")
            }

            let mouseOut = function() {
                tooltip.style("visibility", "hidden")
            }

            var colorScaleGdi = null
             if (type == "gdivalue") {
                colorScaleGdi = d3.scaleThreshold()
                .domain([0.899, 0.925, 0.95, 0.975, 1, 1.025])
                .range(d3.schemeBlues[7]);
             } else if (type == "hdifemale" || type == "hdimale") {
                colorScaleGdi = d3.scaleThreshold()
                .domain([0.2, 0.36, 0.52, 0.68, 0.84, 1])
                .range(d3.schemeBuPu[7]);
             } else if (type == "sdg3female" || type == "sdg3male") {
                colorScaleGdi = d3.scaleThreshold()
                .domain([50, 58, 66, 74, 82, 90])
                .range(d3.schemeYlGnBu[7]);
             } else if (type == "sdg43female" || type == "sdg43male") {
                colorScaleGdi = d3.scaleThreshold()
                .domain([0, 5, 10, 15, 20, 25])
                .range(d3.schemeOranges[7]);
             } else if (type == "sdg44female" || type == "sdg44male") {
                colorScaleGdi = d3.scaleThreshold()
                .domain([0, 5, 10, 15, 20, 25])
                .range(d3.schemeOranges[7]);
             } else if (type == "sdg85female" || type == "sdg85male") {
                colorScaleGdi = d3.scaleThreshold()
                .domain([0, 5000, 10000, 20000, 40000, 80000])
                .range(d3.schemeGreens[7]);
             }
            
            svgGdi.selectAll("*").remove();
            svgGdi
                .append("g")
                .selectAll("path")
                .data(topology.features)
                .enter()
                .append("path")
                // draw each country
                .attr("d", d3.geoPath()
                    .projection(projectionGdi)
                )
                // set the color of each country
                .attr("fill", function (d) {
                    if (dataSource.get(d.id) != null) {
                        if (type == "gdivalue") {
                            d.total = dataSource.get(d.id).gdivalue || 0;
                        } else if (type == "hdifemale") {
                            d.total = dataSource.get(d.id).hdifemale || 0;
                        } else if (type == "hdimale") {
                            d.total = dataSource.get(d.id).hdimale || 0;
                        } else if (type == "sdg3female") {
                            d.total = dataSource.get(d.id).sdg3female || 0;
                        } else if (type == "sdg3male") {
                            d.total = dataSource.get(d.id).sdg3male || 0;
                        } else if (type == "sdg43female") {
                            d.total = dataSource.get(d.id).sdg43female || 0;
                        } else if (type == "sdg43male") {
                            d.total = dataSource.get(d.id).sdg43male || 0;
                        } else if (type == "sdg44female") {
                            d.total = dataSource.get(d.id).sdg44female || 0;
                        } else if (type == "sdg44male") {
                            d.total = dataSource.get(d.id).sdg44male || 0;
                        } else if (type == "sdg85female") {
                            d.total = Number(dataSource.get(d.id).sdg85female).toFixed(2) || 0;
                        } else if (type == "sdg85male") {
                            d.total = Number(dataSource.get(d.id).sdg85male).toFixed(2) || 0;
                        }
                    } else d.total = 0;
                    if (d.total == 0) return "white";
                    if (type == "gdivalue" && d.total > 1) return "pink";
                    return colorScaleGdi(d.total);
                })
                .style("stroke", "black")
                .attr("class", function(d){ return "Country" } )
                .style("opacity", .8)
                .on("mouseover", mouseOver)
                .on("mousemove", mouseMove)
                .on("mouseout", mouseOut)
                
            svgGdi.call(zoom);
        }

        function clickGdiValue() {
            console.log("clickGdiValue")
            renderMap("gdivalue")
            showAppropriateDescription("#gdi-description")
            let allButton = document.querySelectorAll(".button")
            allButton.forEach(enableButton)
            let btnGdiValue = document.querySelector("#btn_gdi_value")
            btnGdiValue.disabled = true
        }

        function clickHdiFemale() {
            console.log("clickHdiFemale")
            renderMap("hdifemale")
            showAppropriateDescription("#hdi-description")
            let allButton = document.querySelectorAll(".button")
            allButton.forEach(enableButton)
            let btnHdiFemale = document.querySelector("#btn_hdi_female")
            btnHdiFemale.disabled = true
        }

        function clickHdiMale() {
            console.log("clickHdiMale")
            renderMap("hdimale")
            showAppropriateDescription("#hdi-description")
            let allButton = document.querySelectorAll(".button")
            allButton.forEach(enableButton)
            let btnHdiMale = document.querySelector("#btn_hdi_male")
            btnHdiMale.disabled = true
        }

        function clickSdg3Female() {
            console.log("clickSdg3Female")
            renderMap("sdg3female")
            showAppropriateDescription("#sdg3-description")
            let allButton = document.querySelectorAll(".button")
            allButton.forEach(enableButton)
            let btnSdg3Female = document.querySelector("#btn_sdg3_female")
            btnSdg3Female.disabled = true
        }

        function clickSdg3Male() {
            console.log("clickSdg3Male")
            renderMap("sdg3male")
            showAppropriateDescription("#sdg3-description")
            let allButton = document.querySelectorAll(".button")
            allButton.forEach(enableButton)
            let btnSdg3Male = document.querySelector("#btn_sdg3_male")
            btnSdg3Male.disabled = true
        }

        function clickSdg43Female() {
            console.log("clickSdg43Female")
            renderMap("sdg43female")
            showAppropriateDescription("#sdg43-description")
            let allButton = document.querySelectorAll(".button")
            allButton.forEach(enableButton)
            let btnSdg43Female = document.querySelector("#btn_sdg43_female")
            btnSdg43Female.disabled = true
        }

        function clickSdg43Male() {
            console.log("clickSdg43Male")
            renderMap("sdg43male")
            showAppropriateDescription("#sdg43-description")
            let allButton = document.querySelectorAll(".button")
            allButton.forEach(enableButton)
            let btnSdg43Male = document.querySelector("#btn_sdg43_male")
            btnSdg43Male.disabled = true
        }

        function clickSdg44Female() {
            console.log("clickSdg44Female")
            renderMap("sdg44female")
            showAppropriateDescription("#sdg44-description")
            let allButton = document.querySelectorAll(".button")
            allButton.forEach(enableButton)
            let btnSdg44Female = document.querySelector("#btn_sdg44_female")
            btnSdg44Female.disabled = true
        }

        function clickSdg44Male() {
            console.log("clickSdg44Male")
            renderMap("sdg44male")
            showAppropriateDescription("#sdg44-description")
            let allButton = document.querySelectorAll(".button")
            allButton.forEach(enableButton)
            let btnSdg44Male = document.querySelector("#btn_sdg44_male")
            btnSdg44Male.disabled = true
        }

        function clickSdg85Female() {
            console.log("clickSdg85Female")
            renderMap("sdg85female")
            showAppropriateDescription("#sdg85-description")
            let allButton = document.querySelectorAll(".button")
            allButton.forEach(enableButton)
            let btnSdg85Female = document.querySelector("#btn_sdg85_female")
            btnSdg85Female.disabled = true
        }

        function clickSdg85Male() {
            console.log("clickSdg85Male")
            renderMap("sdg85male")
            showAppropriateDescription("#sdg85-description")
            let allButton = document.querySelectorAll(".button")
            allButton.forEach(enableButton)
            let btnSdg85Male = document.querySelector("#btn_sdg85_male")
            btnSdg85Male.disabled = true
        }

        function enableButton(button) {
            button.disabled = false
        }

        function showAppropriateDescription(idDescription) {
            let allDescription = document.querySelectorAll(".description");
            allDescription.forEach(hideDescription)
            let selectedDescription = document.querySelector(idDescription);
            selectedDescription.style.display = "block"
        }

        function hideDescription(description) {
            description.style.display = "none";
        }

        function zoomed() {
            d3.select("g")
                .selectAll('path') // To prevent stroke width from scaling
                .attr('transform', d3.event.transform);
        }

        </script>
    </body>
</html>